name: Reusable workflow to read .env 
on: 
  workflow_call:
    inputs:
      file: 
        description: "dotenv file to be used"
        required: true 
        type: string

jobs:
  env:
    name: Load Dotenv
    runs-on: ubuntu-latest

    outputs:
      env: ${{ steps.import-env.outputs.result }}

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Import environment variables from a file
      id: import-env
      uses: actions/github-script@v2
      with:
        script: |
          const file = ${{ inputs.file }}
          const env = parseEnv(`${process.env.GITHUB_WORKSPACE}/file`);
          Object.entries(env).forEach(x => core.exportVariable(...x)); // current job-level env
          return env;

    - name: Print environment variable
      run: echo $ABC
      env: ${{ fromJson(steps.import-env.outputs.result) }} # step-level env

  build:
    runs-on: ubuntu-latest
    needs: [env]
    env: ${{ fromJson(needs.env.outputs.env) }} # job-level env

    steps:
    - name: Print environment variable
      run: echo $ABC

